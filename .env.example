# ========================================
# Forex Companion Backend Environment Template
# Hosting: Railway
# Frontend: Firebase Hosting (or any HTTPS frontend)
# Auth: Firebase Auth
# Transactional Email: Brevo
# ========================================

# -------------------------------
# Runtime
# -------------------------------
DEBUG=false

# -------------------------------
# Frontend redirect base (required in prod)
# Must be HTTPS in production.
# -------------------------------
FRONTEND_APP_URL=https://forexcompanion-e5a28.web.app
EMAIL_VERIFICATION_CONTINUE_URL=https://forexcompanion-e5a28.web.app/verify
PASSWORD_RESET_CONTINUE_URL=https://forexcompanion-e5a28.web.app/reset
FRONTEND_USE_HASH_ROUTES=true

# Optional extra host allowlist for redirects (comma-separated)
# Keep localhost entries only for local development.
REDIRECT_ALLOWLIST=https://forexcompanion-e5a28.web.app,https://forexcompanion-e5a28.firebaseapp.com

# -------------------------------
# CORS (backend)
# In production, set only your real frontend domain(s).
# -------------------------------
CORS_ALLOW_ALL=false
CORS_ALLOW_LOCALHOST=false
CORS_ORIGINS=https://forexcompanion-e5a28.web.app,https://forexcompanion-e5a28.firebaseapp.com
CORS_ORIGIN_REGEX=
CORS_MAX_AGE_SECONDS=86400

# -------------------------------
# Auth endpoint rate limiting
# -------------------------------
AUTH_RATE_LIMIT_ENABLED=true
AUTH_RATE_LIMIT_MAX=10
AUTH_RATE_LIMIT_WINDOW_SECONDS=300
AUTH_LINK_TIMEOUT_SECONDS=20

# Optional global API rate limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX=120
RATE_LIMIT_WINDOW_SECONDS=60

# -------------------------------
# Security hardening
# -------------------------------
ENABLE_HSTS=true
ENABLE_CSP=true
MAX_REQUEST_BODY_BYTES=1048576
# ALLOWED_HOSTS=127.0.0.1,localhost,api.your-domain.com

# -------------------------------
# Firebase Admin + Auth
# -------------------------------
FIREBASE_PROJECT_ID=forexcompanion-e5a28
# Choose one credential method:
# FIREBASE_SERVICE_ACCOUNT_PATH=/path/to/service-account.json
# FIREBASE_SERVICE_ACCOUNT_JSON_B64=<base64-encoded-json>

# Needed for REST fallback in auth link generation
FIREBASE_API_KEY=replace_with_firebase_web_api_key

# Optional strict boot requirement
REQUIRE_FIREBASE=false

# Startup check: ensure FRONTEND_APP_URL host exists in Firebase Auth authorized domains.
FIREBASE_AUTH_DOMAIN_CHECK_ENABLED=true
# In production this should stay true to fail fast on bad Firebase redirect config.
FIREBASE_AUTH_DOMAIN_CHECK_FAIL_FAST=true
FIREBASE_AUTH_DOMAIN_CHECK_TIMEOUT_SECONDS=10

# -------------------------------
# Email provider (Brevo preferred)
# -------------------------------
EMAIL_PROVIDER=brevo

BREVO_API_KEY=replace_with_brevo_api_key
BREVO_FROM_EMAIL=forexcompanionauto@gmail.com
BREVO_FROM_NAME=Forex Companion
BREVO_REPLY_TO=forexcompanionauto@gmail.com

# Optional fallback: Mailjet
# MAILJET_API_KEY=replace_with_mailjet_api_key
# MAILJET_SECRET_KEY=replace_with_mailjet_secret
# MAILJET_FROM_EMAIL=verified_sender@example.com
# MAILJET_FROM_NAME=Forex Companion
# MAILJET_REPLY_TO=support@example.com

# Optional fallback: SMTP
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_USER=user@example.com
# SMTP_PASS=app-password
# SMTP_FROM=user@example.com
# SMTP_TLS=true

# -------------------------------
# Optional dev identity bridge
# -------------------------------
ALLOW_DEV_USER_ID=false
# DEV_USER_LOCALHOST_ONLY=true
# DEV_AUTH_SHARED_SECRET=change_me

# -------------------------------
# Optional websocket/data features
# -------------------------------
FOREX_STREAM_ENABLED=true
FOREX_STREAM_INTERVAL=10
FOREX_RATES_MIN_FETCH_INTERVAL_SECONDS=3
FOREX_NEWS_CACHE_TTL_SECONDS=30
FOREX_SENTIMENT_CACHE_TTL_SECONDS=15
FOREX_FORECAST_CACHE_TTL_SECONDS=20
WS_HEARTBEAT_INTERVAL_SECONDS=25
WS_HEARTBEAT_TIMEOUT_SECONDS=60

# -------------------------------
# Optional background task queue (Phase 5 prep)
# -------------------------------
TASK_QUEUE_ENABLED=true
TASK_QUEUE_BACKEND=memory
TASK_QUEUE_WORKERS=2
TASK_QUEUE_MAX_SIZE=200
TASK_QUEUE_REDIS_KEY=forex:task_queue
TASK_QUEUE_REDIS_BLOCK_SECONDS=1

# -------------------------------
# Optional Redis (for queue + websocket registry scaling)
# -------------------------------
REDIS_ENABLED=false
# REDIS_URL=redis://localhost:6379/0
REDIS_CONNECT_TIMEOUT_SECONDS=2
REDIS_SOCKET_TIMEOUT_SECONDS=2
REDIS_RETRY_SECONDS=5
WS_REDIS_REGISTRY_KEY=forex:ws:registry

# -------------------------------
# Optional ops alerts/metrics thresholds
# -------------------------------
OPS_ALERT_HOOKS_ENABLED=true
OPS_ALERT_QUEUE_DEPTH_WARN=80
OPS_ALERT_QUEUE_DEPTH_CRIT=150
OPS_ALERT_QUEUE_FAILED_WARN=1
OPS_ALERT_WS_STALE_SECONDS=120
OPS_ALERT_WS_STALE_COUNT_WARN=1
OPS_ALERT_FOREX_FAILURE_STREAK_WARN=3
OPS_ALERT_FOREX_RETRY_WARN_SECONDS=20
OPS_ALERT_WEBHOOK_URL=
OPS_ALERT_WEBHOOK_PROVIDER=auto
OPS_ALERT_WEBHOOK_MIN_SEVERITY=warning
OPS_ALERT_WEBHOOK_TIMEOUT_SECONDS=5
# Optional custom auth header for webhook integrations
# OPS_ALERT_WEBHOOK_AUTH_HEADER=Authorization
# OPS_ALERT_WEBHOOK_AUTH_VALUE=Bearer <token>

# -------------------------------
# Optional notifications connectors
# -------------------------------
# TELEGRAM_BOT_TOKEN=
# TELEGRAM_DEFAULT_CHAT_ID=
# DISCORD_WEBHOOK_URL=
# SMS_WEBHOOK_URL=
# WHATSAPP_WEBHOOK_URL=
# NOTIFICATION_WEBHOOK_URL=
